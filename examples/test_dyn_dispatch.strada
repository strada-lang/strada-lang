package Animal;

has ro str $species (required);
has rw int $energy = 100;

func speak(scalar $self) str {
    return "I am a " . $self->species();
}

func get_energy(scalar $self) int {
    return $self->energy();
}

func set_energy_to(scalar $self, int $val) void {
    $self->set_energy($val);
}

package main;

func main() int {
    my scalar $a = Animal::new("species", "cat");

    # Test 1: dynamic call with no extra args
    my str $method = "speak";
    my str $result = $a->$method();
    if ($result ne "I am a cat") {
        say("FAIL test 1: got " . $result);
        return 1;
    }

    # Test 2: dynamic call with args
    my str $setter = "set_energy_to";
    $a->$setter(42);
    if ($a->energy() != 42) {
        say("FAIL test 2: energy=" . $a->energy());
        return 1;
    }

    # Test 3: dynamic call without parens (accessor style)
    my str $getter = "get_energy";
    my int $e = $a->$getter;
    if ($e != 42) {
        say("FAIL test 3: got " . $e);
        return 1;
    }

    # Test 4: method name from hash lookup
    my hash %dispatch = ();
    $dispatch{"action"} = "speak";
    my str $mname = $dispatch{"action"};
    my str $res2 = $a->$mname();
    if ($res2 ne "I am a cat") {
        say("FAIL test 4: got " . $res2);
        return 1;
    }

    say("All dynamic dispatch tests passed");
    return 0;
}
